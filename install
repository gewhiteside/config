#!/bin/bash
# Installs config files, some scripts and sets up git config for this repo.
# Usage: install [OPTION]...
# Options are passed directly to ln (see man ln). Some usefull options are
# --force and --interactive.

# Symlink dotfiles to home directory.
ln -s "$@" $(pwd)/dotfiles/.[!.]*[!~] ~

# Create ~/.emacs.d and ~/.emacs.d/elisp if they don't already exist.
mkdir -p ~/.emacs.d/elisp
# Symlink emacs init file to .emacs.d.
ln -s "$@" $(pwd)/.emacs.d/init.el ~/.emacs.d
# Symlink elisp files to .emacs.d/elisp.
ln -s "$@" $(pwd)/.emacs.d/elisp/*[!~] ~/.emacs.d/elisp

# Create user bin directory.
mkdir -p ~/bin
# Symlink some scripts.
ln -s "$@" $(pwd)/bin/{config-filter,mv-ln} ~/bin

# Remove irrelevant dotfiles for certain systems.
case $(uname) in
  Linux)
      rm ~/.mintty* ;;
  CYGWIN*)
      rm ~/.screenrc ;;
esac

# Create machine-specific bash init file.
touch ~/.bash_$(hostname -s)

# Create machine-specific emacs init file.
touch ~/.emacs.d/elisp/$(hostname -s).el

# Set up git config for this repo.
filter_include='path = ../.gitfilters'
if ! grep -q "$filter_include" .git/config; then
    echo -e "[include]\n\t$filter_include" >>.git/config
fi
