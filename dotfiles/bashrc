# If this shell is not interactive, don't do anything.
[[ $- != *i* ]] && return

source ~/.bash_aliases
source ~/.bash_prompt
source ~/.git-completion.bash
source ~/.git-prompt.sh

# Increase the size of the  history file.
HISTFILESIZE=3000
# Don't put duplicate lines or lines starting with space in the history.
HISTCONTROL=ignoreboth
# Time stamp commands in the history file.
HISTTIMEFORMAT="%F %T "
# Append to the history file, don't overwrite it.
shopt -s histappend

# Don't try to complete an empty command.
shopt -s no_empty_cmd_completion

# Add a project-specific symlink in <project_root>/.symlinks.
project-symlink() {
    if [ -z "$PROJECT" ]; then
        echo "error: set PROJECT before calling ${FUNCNAME[0]}"
        return 1
    fi

    mkdir -p $project_root/.symlinks

    local target="$1"
    local link_name=
    if [ "$2" ]; then
        link_name="$2"
    else
        link_name="${target##*/}"
    fi
    ln -T -f -s "$target" "$project_root/.symlinks/$link_name"
}

# If PROJECT is empty, just use the builtin cd. If PROJECT is not empty, with no
# arguments, cd to the project root. Otherwise, cd without following symlinks
# and without standard output.
cd() {
    if [ -z "$PROJECT" ]; then
        command cd "$@"
        return
    fi

    if [ "$#" -eq 0 ]; then
        command cd "${PROJECT#*:}"
    else
        command cd -P "$@" >/dev/null
    fi
}

# NB(whiteside): Reservoir environment setup depends on functions defined in
# this file, so source it last.
[ -f ~/reservoir/bash/bash_reservoir ] && source ~/reservoir/bash/bash_reservoir
